<div class="admin-container">
    <main class="content">
        <div class="unity-container">
            <div class="aspect-ratio-box">
                <div id="unity-container">
                    <canvas id="unity-canvas"></canvas>
                    <div id="unity-loading-bar">
                        <div id="unity-logo"></div>
                        <div id="unity-progress-bar-empty">
                            <div id="unity-progress-bar-full"></div>
                        </div>
                    </div>
                    <div id="unity-warning"></div>
                </div>
            </div>
        </div>
    </main>
</div>

<style>
    .unity-container {
        background: #444;
        border-radius: 10px;
        overflow: hidden;
        width: 100%;
    }
    
    /* Tạo tỷ lệ 16:9 cho container */
    .aspect-ratio-box {
        position: relative;
        width: 100%;
        padding-top: 56.25%; /* Tỷ lệ 9:16 = 56.25% */
        overflow: hidden;
    }
    
    #unity-container { 
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
    
    #unity-canvas { 
        width: 100%;
        height: 100%;
        background: #231F20;
    }
    
    #unity-loading-bar { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); display: none }
    #unity-logo { width: 154px; height: 130px; background: #444; }
    #unity-progress-bar-empty { width: 141px; height: 18px; margin-top: 10px; background: #555; }
    #unity-progress-bar-full { width: 0%; height: 18px; margin-top: 10px; background: #4CAF50; }
    
    #unity-warning { position: absolute; left: 50%; top: 5%; transform: translate(-50%); background: white; padding: 10px; display: none }
    
    /* Media query cho màn hình nhỏ hơn */
    @media (max-width: 768px) {
        .aspect-ratio-box {
            padding-top: 75%; /* Tỷ lệ 4:3 cho màn hình nhỏ hơn */
        }
    }
</style>

<script>
    var buildUrl = "/unity"; // Thư mục chứa build Unity WebGL
    var loaderUrl = buildUrl + "/ArtGalleryAdmin.loader.js";
    var config = {
        dataUrl: buildUrl + "/ArtGalleryAdmin.data",
        frameworkUrl: buildUrl + "/ArtGalleryAdmin.framework.js",
        codeUrl: buildUrl + "/ArtGalleryAdmin.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "Your Company",
        productName: "Gallery Admin",
        productVersion: "1.0",
    };

    var container = document.querySelector("#unity-container");
    var canvas = document.querySelector("#unity-canvas");
    var loadingBar = document.querySelector("#unity-loading-bar");
    var progressBarFull = document.querySelector("#unity-progress-bar-full");
    var warningBanner = document.querySelector("#unity-warning");

    // By default Unity keeps WebGL canvas render target size matched with
    // the DOM size of the canvas element (scaled by window.devicePixelRatio)
    // Set this to false if you want to decouple this synchronization from
    // happening inside the engine, and you would instead like to size up
    // the canvas DOM size and WebGL render target sizes yourself.
    // config.matchWebGLToCanvasSize = false;

    if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        container.className = "unity-mobile";
        // Avoid draining fillrate performance on mobile devices,
        // and default/override low DPI mode on mobile browsers.
        config.devicePixelRatio = 1;
        unityShowBanner('WebGL builds are not supported on mobile devices.');
    } else {
        // Không cần thiết lập kích thước canvas ở đây vì đã được xử lý trong CSS
    }
    loadingBar.style.display = "block";

    // Kiểm tra xem file loader có tồn tại không
    fetch(loaderUrl)
        .then(response => {
            if (response.ok) {
                var script = document.createElement("script");
                script.src = loaderUrl;
                script.onload = () => {
                    createUnityInstance(canvas, config, (progress) => {
                        progressBarFull.style.width = 100 * progress + "%";
                    }).then((unityInstance) => {
                        loadingBar.style.display = "none";
                    }).catch((message) => {
                        warningBanner.style.display = 'block';
                        warningBanner.textContent = 'Lỗi khi tạo Unity instance: ' + message;
                        loadingBar.style.display = "none";
                    });
                };
                document.body.appendChild(script);
            } else {
                warningBanner.style.display = 'block';
                warningBanner.textContent = 'Không tìm thấy Unity WebGL loader. Vui lòng kiểm tra thư mục /unity';
                loadingBar.style.display = "none";
            }
        })
        .catch(error => {
            warningBanner.style.display = 'block';
            warningBanner.textContent = 'Lỗi khi tải Unity WebGL: ' + error;
            loadingBar.style.display = "none";
        });

    function unityShowBanner(msg, type) {
        warningBanner.style.display = 'block';
        warningBanner.style.backgroundColor = type == 'error' ? 'red' : 'yellow';
        warningBanner.innerHTML = msg;
    }
</script>